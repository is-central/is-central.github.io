<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="/admin/config.yml" type="text/yaml" rel="cms-config-url" />
    <title>IS Central - Content Manager</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  </head>
  <body>
    <!-- Load Decap CMS v3.6.1 -->
    <script src="https://unpkg.com/decap-cms@3.6.1/dist/decap-cms.js" type="text/javascript"></script>
    <!-- Your CMS config -->
    <!-- <script src="/admin/config.js"></script> -->
    
    <script>
      // Check if user is on the correct domain for CMS access
      const hostname = window.location.hostname;
      
      if (hostname === 'is-central.github.io') {
        // GitHub Pages - show blocking warning
        document.body.innerHTML = `
          <div style="
            padding: 2rem; 
            background: #fee; 
            border: 2px solid #f88; 
            border-radius: 8px; 
            margin: 2rem auto; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 600px;
          ">
            <h2 style="color: #c33; margin-top: 0;">⚠️ CMS Not Available Here</h2>
            <p><strong>The CMS admin interface does not work on GitHub Pages.</strong></p>
            <p>Please visit the official admin page: <a href="https://is-central.netlify.app/admin/" style="color: #0066cc;">https://is-central.netlify.app/admin/</a></p>
            <p><small>GitHub Pages cannot provide the authentication needed for the CMS.</small></p>
          </div>
        `;
      } else if (hostname.includes('netlify.app') && hostname !== 'is-central.netlify.app') {
        // Netlify preview deploy - show warning with option to proceed
        const warningDiv = document.createElement('div');
        warningDiv.id = 'preview-warning';
        warningDiv.style.cssText = `
          position: fixed; 
          top: 0; 
          left: 0; 
          right: 0; 
          background: #fff3cd; 
          border-bottom: 2px solid #ffc107; 
          padding: 1rem; 
          z-index: 10000;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
          text-align: center;
        `;
        warningDiv.innerHTML = `
          <div style="max-width: 800px; margin: 0 auto;">
            <strong>⚠️ Preview Deploy Warning</strong><br>
            You are currently on a preview page. While it is possible to use the admin panel here, it is strongly discouraged. 
            <a href="https://is-central.netlify.app/admin/" style="color: #0066cc;">Go to main admin page</a> or 
            <button onclick="document.getElementById('preview-warning').style.display='none'" style="background: #6c757d; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">Proceed Anyway</button>
          </div>
        `;
        document.body.insertBefore(warningDiv, document.body.firstChild);
        
        // Also show warning after CMS loads (for already logged in users)
        setTimeout(() => {
          if (document.getElementById('preview-warning')) {
            document.getElementById('preview-warning').style.display = 'block';
          }
        }, 2000);
      }
      
      // Initialize Netlify Identity (only on correct domains)
      if (window.netlifyIdentity && (hostname === 'is-central.netlify.app' || hostname === 'localhost' || hostname.includes('netlify.app'))) {
        window.netlifyIdentity.on("init", user => {
          if (!user) {
            window.netlifyIdentity.on("login", () => {
              document.location.href = "/admin/";
            });
          }
        });
      }
    </script>
  </body>
</html>